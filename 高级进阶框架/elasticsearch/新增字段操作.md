```
# 给es里某个字段增加一个子类型，要求之前的数据也能被查询到
DELETE course_table
PUT course_table
{
  "mappings": {
    "properties": {
      "courseinfo": {
        "type": "nested",
        "properties": {
          "teacherno": {
            "type": "keyword",
            "fields": {
              "teachername": {
                "type": "text",
                "analyzer": "ik_max_word"
              }
            }
          },
          "coursename": {
            "type": "keyword"
          }
        }
      }
    }
  }
}

GET course_table/_mapping
POST course_table/_cache/clear

# 写入一条数据
PUT course_table/_doc/1
{
  "courseinfo": [
    {
      "coursename":"语文",
      "teacherno":"张三"
    }
  ]
}

GET course_table/_search

# 修改字段mapping，增加一个子字段
PUT course_table/_mapping
{
  "properties": {
    "courseinfo":{
      "type":"nested",
      "properties": {
        "coursename":{
          "type":"keyword"
        },
        "teacherno":{
          "type":"keyword",
          "fields":{
            "teachername":{
              "type":"text",
              "analyzer":"ik_max_word"
            },
            "teachersex":{
              "type":"text",
              "analyzer":"ik_smart"
            }
          }
        }
      }
    }
  }
}

GET course_table/_mapping

PUT course_table/_doc/2
{
  "courseinfo": [
    {
      "coursename": "数学",
      "teacherno": "李四"
    }
  ]
}

# 此次查询不生效，因为张三这个旧文档没有新增字段teachersex
GET course_table/_search
{
  "query": {
    "nested": {
      "path": "courseinfo",
      "query": {
        "bool": {
          "filter": {
            "term": {
              "courseinfo.teacherno.teachersex": "张三"
            }
          }
        }
      }
    }
  }
}

# 新增字段后，想让旧数据也能生效，可以通过_update_by_query
POST course_table/_update_by_query
```