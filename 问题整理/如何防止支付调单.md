# 内部掉单
### 防止服务端掉单：同步调用重试机制
支付服务调用订单服务的时候，要进行失败重试，防止网络抖动情况下的调用失败

### 防止服务端掉单：异步消息可靠性投递
同步不稳妥，那就再加一个异步。支付服务投递一个支付成功消息，订单服务消费支付成功消息，整个过程要尽可能保证可靠性，
例如订单服务要在完成订单状态更新后再确认完成消息消费。

# 防止客户端掉单：客户端轮询
客户端判断用户未支付之后，通常会进行订单倒计时。客户端组件倒计时功能，要定期向服务端请求，检查倒计时时间

### 防止客户端掉单：服务端推送
```
https://mp.weixin.qq.com/s?__biz=MzkwODE5ODM0Ng==&mid=2247492091&idx=1&sn=0a9d537d7e04035d4496e51b7e2fe7ed&scene=21#wechat_redirect
```

# 外部掉单
内部掉单发生的概率相对较少，掉单最主要的原因还是外部掉单  
外部掉单解决的关键点是```主动查询```，有两种常用的方案：```定时任务查询```和```延时消息查询```。```延时消息查询```的好处是时效性更好，
而且无需扫表，对数据库压力较小

