# 自定义负载均衡规则
解决思路如下：  
① ```普通用户```访问服务器上的页面时，请求的所有路由只调用服务器上的实例  
② ```开发A```访问时，请求的所有路由优先调用```开发A本机启动的实例```，如果没有则调用```服务器上的实例```  
③ ```开发B```访问时同上，请求的所有路由优先调用```开发B本机启动的实例```，如果没有则调用```服务器上的实例```

### 区分不同用户的服务实例
在注册中心中添加元数据，启动实例后，元数据就会注册上去
```yaml
spring: 
  cloud: 
    nacos: 
      discovery: 
        server-addr: localhost:8848
        metadata: 
          version: zkh
```
经过元数据区分后，服务器的实例version值为空。开发人员自己本地启动的实例version的值是自定义值

### 自定义负载均衡规则
① 根据上游输入的版本号version，有值的话则取```服务元信息```中```version```值一样的实例  
② 上游的版本号version没值或者该版本号匹配不到任务服务，则只取```服务元信息```中```version```值为空的实例

### 上游的version标识的传递
① 在请求头中添加  
② 在请求参数中添加