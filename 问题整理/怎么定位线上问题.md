# 理念
1 对核心接口做好监控告警功能，监控报警最先能发现问题  
业务代码层面的监控报警，因为监控报警是自己写的原因，所以能很快地定位出问题原因所在  
服务器资源/中间件资源的监控报警，需要花费时间排查了  
2 如果近期发布过系统，判断版本回滚是否能解决问题，并同步业务人员做相应配合（回滚很可能是最快能恢复线上正常运行的办法）  
3 恢复线上正常运行后，若不能迅速定位出来，看能不能复现，能复现都好说，肯定是能解决的  
4 如果是业务侧反馈问题，就需要明确是哪个具体的功能或者接口出现的问题，并确认操作流程和页面响应结果，然后排查日志，也应该能快速定位问题  
```
问题不能迅速定位出来，很多时候就是日志不够详细，而日志在正常情况下也不应太多
```
5 再查系统资源瓶颈，观察MySQL的CPU有没有飙高，主从同步延迟是否很大，有没有MySQL，Redis内存是否满了，搜索引擎有么有慢Query。  
再观察服务接口的QPS/RT相关的监控，看看这些指标有哪项不对  
6 如果不是中间件性能问题，再看应用和服务器本身的问题：应用GC、机器本身的网络/磁盘/内存/CPU各种指标有没有异常情况
![img.png](images/问题定位流程图.png)

# 502 问题排查
① HTTP状态码用来表示响应结果的状态，其中200是正常响应，4xx是客户端错误，5xx是服务端错误  
② 客户端和服务端之间加入nginx，可以起到反向代理和负载均衡的作用，客户端只管向nginx请求数据，并不关心这个请求具体由哪个服务器来处理  
③ 后端服务端应用如果发生崩溃，nginx在访问服务端时会收到服务端返回的RST报文，然后给客户端返回502报错。502并不是服务端应用发出的，
而是nginx发出的。因此发生502时，后端服务端很可能没有没有相关的502 日志，需要在nginx侧才能看到这条502 日志  
④ 如果发现502，优先通过监控排查服务端应用是否发生过崩溃重启，如果是的话，再看下是否留下过崩溃堆栈日志，如果没有日志，
看下是否可能是oom或者是其他原因导致进程主动退出。如果进程也没崩溃过，去排查下nginx的日志，看下是否将请求打到了某个不知名IP端口上



