# 数据库唯一索引
①　加唯一索引：利用唯一索引冲突  
先select一下数据，如果数据已经存在，就拦截是重复请求，直接返回成功，如果数据不存在，再通过唯一索引冲突做最后保证，即插入数据异常，则可以直接返回成功
> 加唯一索引是个非常简单但很有效的办法，如果重复插入数据的话，就会抛出异常，为了保证幂等性，一般需要捕获这个异常
> 如果是java程序需要捕获：DuplicateKeyException异常，如果使用了spring框架还需要捕获：MySQLIntegrityConstraintViolationException异常。

②　数据库主键实现幂等性　　
不使用MySQL中的自增主键，使用分布式id充当主键。这样重复的insert操作就会因为主键冲突而操作失败

# 状态标识
①　有些业务表是有状态的，比如订单表中有：1-下单、2-已支付、3-完成、4-撤销等状态，可以通过```限制状态```的流动来完成幂等  
② 乐观锁的方式实现幂等性：在表中增加一个timestamp或者version字段。将version字段作为更新的条件，同时也更新version。
更新成功后，version增加，重复更新请求进来就无法更新了。乐观锁存在ABA的问题，如果version版本一直是自增的就不会出现ABA的情况了

# 悲观锁

①加Redis分布式锁的排他锁。可以通过控制锁的粒度来提高程序的执行性能

②使用select * for update

# 乐观锁

版本号等机制