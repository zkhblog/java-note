# 概述

死锁是多个进程或线程因竞争有限的资源而发生的一种相互等待的状态，使得每个进程或线程都无法继续执行。

# 排查思路

①用```show engine innodb status```，查看最近一次死锁日志

②分析死锁日志，找到关键词```TRANSACTION```

③分析死锁日志，查看正在执行的SQL

④看它持有什么锁，等待什么锁

⑤用```SELECT * FROM performance_schema.data_locks\G;```查看SQL加锁情况

 # 解决方案

### 事务方面

①保证事务顺序，避免事务的循环互相等待

②减少事务的大小和范围

③

### 方案一、设置任务超时等待时间

​      当在一个任务的等待时间超过了这个时间之后，就进行**回滚**;

​      在 InnoDB 中，参数 **innodb_lock_wait_timeout **是用来设置超时时间的，默认值时 50 秒。

------

###      方案二、主动开启死锁检测

​        将参数 **innodb_deadlock_detect** 设置为 on。

​        当innodb检测发现死锁之后，就会进行回滚死锁的事物。

------

###       方案三、对于更新频繁的字段，采用唯一索引的设置方案

​         例如在上面的例子当中，可以把no字段设置成唯一索引。    