# 服务降级和服务熔断
当系统压力很大时，通过关闭某个服务或者限制某个服务的流量来减轻系统的压力，保证核心服务的正常使用。服务熔断是指下游服务不可用时，
上游服务不再调用下游服务，而是直接返回一个结果，持续到下游服务可用时。熔断是下游服务故障触发的，降级是为了降低系统的请求压力。

# 服务降级
什么是服务雪崩？（一种故障现象）
当多个微服务之间调用时，在这个扇出的链路上某个微服务的响应时间过长或者服务不可用，就会导致整个系统
崩溃，形成所谓的“雪崩效应”。在这样的情况下，发现一个模块的某个实例失败后，这个有问题的模块还调用了其他的模块，
这样就会发生级联故障。

Hystrix的三个重要概念？
1、服务降级
对方系统不可用了，需要给出一个终极解决办法，向调用方返回一个符合预期的、可处理的备选响应（fallback），而不是长时间的等待
或者抛出调用方无法处理的异常。
发生的情况：程序运行异常、超时、服务熔断出发服务降级、线程池/信号量打满也会导致服务降级
处理办法：
服务提供方设置自身调用超时时间的峰值，峰值内可以正常运行，超过了需要有兜底的方法处理，作为服务降级fallback，
在服务提供方的超时方法上
标注@HystrixCommand，此注解内写明超时后的处理方法，又能写明超时时长，然后在主启动类上标注@EnableCircuitBreaker启用注解
在配置超时后处理方法时可以使用@DefaultProperties(defaultFallback="")统一全局的异常处理方法
上面的处理办法是在服务提供方作的服务降级处理，除此之外，还可以在客户端做服务降级处理，在客户端做服务降级处理的办法：
实现@FeignClient标注的接口，在实现类里写服务降级的处理逻辑，这样做的话，即使服务提供方挂了，也不影响服务消费方给出友好提示信息

2、服务熔断
类比保险丝达到最大服务访问后，直接拒绝访问，然后调用服务降级的方法并返回友好提示
熔断机制是应对雪崩效应的一种微服务链路保护机制。当扇出链路的某个微服务出错不可用或者响应时间太长时，会进行服务的降级，进而
熔断该节点微服务的调用，快速返回错误的响应信息。当检测到该节点微服务调用响应正常后，恢复调用链路。
熔断类型：熔断打开、熔断关闭、熔断半开
断路器的三个重要参数：
快照时间窗：断路器确定是否打开需要统计一些请求和错误数据，而统计的时间范围就是快照时间窗，默认为最近的10秒
请求总数阈值：在快照时间窗内，必须满足请求总数阈值才有资格熔断。默认为20，也就是在10秒内，调用次数不足20次，即使
所有请求都超时或其他原因失败，断路器都不会打开。
错误百分比阈值：当请求总数在快照时间窗内超过了阈值，在默认设定50%阈值情况下，这时候就会讲断路器打开。
断路器开启的条件：默认10秒内超过20个请求，并且请求内50%以上的都失败，到达以上阈值，断路器将会开启
当开启的时候，所有的请求都不会进行转发
一段时间后（默认是5秒），这个时候断路器时半开状态，会让其中一个请求进行转发，失败继续开启，成功则断路器关闭
断路器打开之后，再有请求调用的时候，将不会调用主逻辑，而是直接调用降级fallback，通过断路器，
实现了自动发现错误并讲降级逻辑切换为主逻辑，减少响应延迟的效果。
主逻辑的恢复靠Hystrix实现的自动恢复功能。当断路器打开，对主逻辑进行熔断之后，hystrix会启动一个休眠时间窗，
在这个时间窗内，降级逻辑是临时的
主逻辑，当休眠时间窗到，断路器进入半开状态，释放一次请求到原来的主逻辑上，如果此次请求正常返回，那么断路器会闭合，主逻辑恢复，
如果这次请求依然有问题，断路器继续进入打开状态，休眠时间窗重新计时。

3、服务限流
秒杀高并发等操作，严禁拥挤，有序进行